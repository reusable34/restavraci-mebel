#!/bin/bash
# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 502 Bad Gateway

echo "üîç –ü—Ä–æ–≤–µ—Ä—è—é –ª–æ–≥–∏ nginx –¥–ª—è –æ—à–∏–±–æ–∫..."
tail -20 /var/log/nginx/error.log | grep -E "(provintagevrn|502|upstream|connect)" || tail -20 /var/log/nginx/error.log

echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å NPM —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º Host header..."
curl -v -H 'Host: provintagevrn.ru' http://192.168.0.31:80 2>&1 | grep -E "(Connected|HTTP|Host|502)" | head -10

echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—è—é, –º–æ–∂–µ—Ç –ª–∏ NPM –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é..."
echo "   (–≠—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞ NPM, –Ω–æ –ø–æ–ø—Ä–æ–±—É–µ–º —Å —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)"
curl -I http://85.113.129.96:3381 2>&1 | head -5

echo ""
echo "üí° –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:"
echo "   1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ NPM –Ω–∞—Å—Ç—Ä–æ–µ–Ω Proxy Host –¥–ª—è provintagevrn.ru -> 85.113.129.96:3381"
echo "   2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ NPM –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ 85.113.129.96:3381"
echo "   3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–ø—Ä—è–º—É—é –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ localhost:3381 (–º–∏–Ω—É—è NPM)"


# Команды для выполнения на сервере (root@kolas:~#)

# 1. Скачайте архив (выполните на сервере)
cd /tmp
wget http://192.168.0.112:8080/restavraci-deploy.tar.gz

# 2. Установите Node.js и зависимости
apt-get update
apt-get install -y curl build-essential
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt-get install -y nodejs

# 3. Создайте директорию и распакуйте архив
mkdir -p /opt/restavraci
cd /opt/restavraci
tar -xzf /tmp/restavraci-deploy.tar.gz

# 4. Установите зависимости и соберите проект
npm ci
npm run build

# 5. Создайте .env файл
cat > /opt/restavraci/.env << 'EOF'
SANITY_PROJECT_ID=143zykun
SANITY_DATASET=production
SANITY_API_VERSION=2025-01-01
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
TELEGRAM_CHAT_ID=your_telegram_chat_id_here
CONTACT_EMAIL=noreply@example.com
NEXT_PUBLIC_SANITY_PROJECT_ID=143zykun
NEXT_PUBLIC_SANITY_DATASET=production
NEXT_PUBLIC_SANITY_API_VERSION=2025-01-01
PORT=3000
EOF

# 6. Создайте systemd service
cat > /etc/systemd/system/restavraci.service << 'EOF'
[Unit]
Description=RestavraciMebel Next.js Application
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/restavraci
Environment="NODE_ENV=production"
EnvironmentFile=/opt/restavraci/.env
ExecStart=/usr/bin/npm start
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF

# 7. Запустите сервис
systemctl daemon-reload
systemctl enable restavraci.service
systemctl start restavraci.service

# 8. Проверьте статус
systemctl status restavraci.service

# 9. Отредактируйте .env и заполните TELEGRAM_BOT_TOKEN и TELEGRAM_CHAT_ID
nano /opt/restavraci/.env

# 10. После редактирования перезапустите
systemctl restart restavraci.service

